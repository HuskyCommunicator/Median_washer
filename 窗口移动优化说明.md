# 洗炼助手优化说明

## 优化时间
2026年1月28日 (第三次优化：窗口移动支持)

## 解决痛点
**之前**：每次移动游戏窗口，录制的坐标就会失效，必须重新录制。
**现在**：支持游戏窗口跟随！只要录制一次，无论游戏窗口怎么移动，都能自动识别位置。

## 原理说明
1. **相对坐标**：系统现在不仅仅记录屏幕绝对坐标，还会记录当时**所属的游戏窗口**。
2. **自动吸附**：每次启动洗炼时，程序会自动寻找该游戏窗口，并根据窗口当前位置计算出真实的鼠标点击位置。
3. **无缝体验**：不需要做额外操作，只要游戏窗口开着就能找到。

## 使用方法
1. **必须重新定位一次**：
   - 因为旧的配置不知道你对应的是哪个游戏窗口，所以需要重新进行【新建】或【编辑/定位】。
   - 在定位流程中，增加了一步：**[0/3] 识别游戏窗口**。
   - 按照提示，点击/激活游戏窗口，然后按空格键绑定。
2. **随意移动**：
   - 录制完成后，你可以随意拖动游戏窗口，甚至把它放到副显示器。
   - 点击【开始洗炼】时，程序会在日志中显示：`已定位窗口位置: (x, y)`。

## 注意事项
- 只有**重新录制**过的配置才支持窗口移动。旧配置依然使用绝对坐标（不能动窗口）。
- 如果找不到游戏窗口（比如游戏关了），程序会报错并停止。
- 确保游戏窗口标题是唯一的（通常没问题）。

## 修改的文件
- `src/gear_washer/win32_utils.py` (新增：底层窗口操作)
- `src/gear_washer/db_helper.py` (修改：增加存储窗口标题)
- `src/gear_washer/washer.py` (核心：增加相对坐标计算)
- `gui.py` & `run_washer_v2.py` (适配新逻辑)
