# 洗炼助手优化说明

## 优化时间
2026年1月28日 (第四次优化：规则完全可编辑化)

## 优化内容：解放所有规则

### 1. 痛点解决
**之前**：系统自带的“默认规则”（如config文件中的规则）是只读的，您想改个数值必须【另存为】新规则，导致列表里有一堆重复的，而且默认的还删不掉。
**现在**：**所有的规则都是平等的，都可以编辑、删除、重命名！**

### 2. 机制变更
- **自动迁移**：程序第一次启动（或数据库里没有这些规则）时，会自动把文件里的默认规则导入到数据库中。
- **不再依赖文件**：以后 GUI 界面只读取数据库里的规则，不再读取 `config/affix_config.py` 文件（那个文件现在只作为第一次使用的模板）。
- **完全控制**：
  - 看那个“法师_全技能”不顺眼？直接点【覆盖保存】修改它！
  - 某个默认规则用不到？直接点【删除本规则】！
  - 想改个名字？点【重命名】！

### 3. 使用注意
- 如果您之前已经在数据库里存了很多规则，这次更新不会影响它们。
- 如果您不想用默认规则，删了就行，它们不会再“复活”（除非手动清空数据库）。
- `[文件]` 前缀的规则将消失，统一变成 `[DB]` 或直接显示名字。

## 操作方法
1. 打开 GUI 程序。
2. 在规则下拉框里选择任意一个规则（包括以前的默认规则）。
3. 随意修改下方的 JSON 或使用【编辑规则详情】。
4. 现在可以尽情点击 **【覆盖保存】**、**【重命名】** 或 **【删除本规则】** 了。

## 修改的文件
- `src/gear_washer/db_helper.py`: 增加了 `migrate_defaults` 方法，用于数据迁移。
- `gui.py`: 移除了对 File Source 的特殊只读限制，改为只从 DB 读取。
- `run_washer_v2.py`: 命令行版也同步改为只从 DB 读取。
