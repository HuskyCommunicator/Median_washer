# 洗炼助手 Pro (MedianWasher Pro) - 操作手册

## 📖 项目介绍
**洗炼助手 Pro** 是一款专为暗黑破坏神2（特别是 Median XL 模组）设计的自动化装备洗炼工具。它利用先进的 OCR（光学字符识别）技术，实时读取游戏内装备的属性词缀，并根据用户设定的规则自动进行洗炼操作（循环按下 'Z' 键），直到匹配到心仪的属性为止。

### 核心功能
- **👀 OCR 智能识别**：无需读取内存，纯视觉识别，安全可靠。支持中文、英文、数字识别。
- **🖥️ 图形化界面 (GUI)**：基于 CustomTkinter 构建的现代化深色界面，操作简单直观。
- **⚙️ 灵活的规则系统**：支持简单关键词匹配（如"技能 +3"）和复杂逻辑编辑（如"力量 > 50 且 敏捷 > 50"）。
- **💾 装备库管理**：可以保存不同装备的坐标配置，支持多装备切换，无需重复校准。
- **🔧 交互式定位**：简单的向导模式，只需鼠标指指点点即可完成坐标设置。

---

## 🚀 快速开始

### 1. 运行前准备
* **管理员权限**：由于程序需要监听全局键盘事件（快捷键）和模拟按键，**必须以管理员身份运行**生成的 `.exe` 文件或终端。
* **游戏设置**：建议将游戏窗口化运行，以确保 OCR 截图准确。

### 2. 软件使用流程

#### 第一步：装备管理 (校准坐标)
1. 进入 **[装备管理]** 标签页。
2. 点击 **[新建装备配置]** 或选择已有配置点击 **[重新定位]**。
3. 按照控制台/日志提示进行三步校准：
   - **绑定窗口**：点击游戏窗口，确保它是活动窗口，按 **空格键**。
   - **记录装备位置**：鼠标悬停在装备图标上（显示属性的位置），按 **空格键**。
   - **记录词缀区域**：鼠标分别点击属性文字区域的 **左上角** 和 **右下角**，各按一次 **空格键**。
4. 校准完成后，记得点击 **[保存配置]**。

#### 第二步：规则配置
1. 进入 **[规则管理]** 标签页。
2. 可以直接在简单编辑器输入关键词（如 `冰霜抗性`）。
3. 也可以点击 **[打开高级编辑器]** 使用 JSON 格式编写复杂逻辑（支持 `MIN`, `MAX`, `AND`, `OR` 等逻辑）。
4. 保存你的规则。

#### 第三步：开始洗炼
1. 进入 **[运行控制]** 标签页。
2. 在左侧选择刚才配置的 **装备**。
3. 在右侧选择要使用的 **规则**。
4. 确保游戏窗口可见，鼠标不要遮挡文字区域。
5. 点击 **[开始洗炼]** 按钮，或者按快捷键 **[END]** 键。

### 🛑 停止与控制
- **开始快捷键**：`END`
- **强制停止快捷键**：`HOME`
- **手动中止**：脚本运行期间，鼠标移动可能会干扰，建议使用键盘 `HOME` 键停止。

---

## ⚠️ 常见问题

**Q: 按空格键没反应？**
A: 请确保程序是以**管理员身份运行**的。Windows 拦截了底层键盘钩子。

**Q: 识别率低，经常识别错误？**
A: 
1. 确保游戏内的字体清晰，尽量不要有半透明背景干扰。
2. 在校准时，[词缀区域] 尽量只框选文字部分，不要包含无关的边框或图标。
3. 可以在代码或配置中调整 `ocr_scale_factor`（默认 2.5 倍放大）。

**Q: 找不到 OCR/Tesseract 文件？**
A: 如果是自行编译运行，请确保 `OCR/tessdata` 目录下有 `chi_sim.traineddata` 等文件。如果是打包后的 EXE，请确保 `OCR` 文件夹在 EXE 同级或目录下。

---

## 🛠️ 技术栈
- **语言**: Python 3.14
- **界面**: CustomTkinter
- **识别**: Tesseract-OCR (pytesseract)
- **输入**: Keyboard, PyAutoGUI
- **打包**: PyInstaller
